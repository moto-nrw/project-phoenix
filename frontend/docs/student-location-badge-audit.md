Student location badges share a common color palette but diverge in trigger logic, data freshness, and label sources across OGS groups, student search, My Room, and the student detail modal, leading to mismatched states and missing coverage.

| State | OGS group view | Student search | My Room | Student detail modal |
| --- | --- | --- | --- | --- |
| In assigned group room | Label = `currentGroup.room_name` fallback “Gruppenraum”; #83CD2D with gradient `from-emerald-50/80 to-green-100/80`; fed by `studentService.getStudents` plus `/api/groups/:id/students/room-status` and SSE refresh on check-in/out events (src/app/ogs_groups/page.tsx:88-150,389-402). | Label hard-coded “Gruppenraum”; same styling; relies on merged room-status map fetched during searches (no SSE) (src/app/students/search/page.tsx:37-120,289-305). | Badge shows group name only with fixed #5080D8 gradient `from-blue-50/80 to-cyan-100/80`; uses `activeService.getActiveGroupVisitsWithDisplay` + `fetchStudent` and SSE, but ignores actual location (src/app/myroom/page.tsx:78-168,413-428). | No badge rendered; modal header omits location entirely despite fetching student details (src/components/students/student-detail-modal.tsx:152-200).
| In other room (`current_room_id`) | Resolves `roomIdToNameMap`; blue styling `#5080D8`; same real-time feed (src/app/ogs_groups/page.tsx:407-418). | Same name/blue styling; updates only on refetch (src/app/students/search/page.tsx:306-314). | Still shows group name; state not surfaced (src/app/myroom/page.tsx:413-428). | Not shown. |
| School yard | Label “Schulhof”; orange #F78C10; depends on legacy `student.school_yard` flag set false in mapper (src/app/ogs_groups/page.tsx:422-429; src/lib/student-helpers.ts:161-164). | Same label/styling with same legacy dependency (src/app/students/search/page.tsx:317-325). | Not handled. | Not shown. |
| On the move / Bus | Label “Unterwegs”; fuchsia #D946EF when `student.in_house` or location == Bus; conflicts with mapper that marks all “Anwesend” as `in_house` (src/app/ogs_groups/page.tsx:431-440; src/lib/student-helpers.ts:161). | Label “Unterwegs” only when `student.in_house`; Bus / “Anwesend - …” fall through (src/app/students/search/page.tsx:328-336). | Not handled (badge stays blue) (src/app/myroom/page.tsx:413-428). | Not shown; ModernStatusBadge (unused) would support Bus (src/components/simple/student/ModernStatusBadge.tsx:6-84). |
| Generic “Anwesend” | N/A (assumes user’s group). | Label “Anwesend” only for exact string, adds glow classes; more specific strings fall back to “Zuhause” (src/app/students/search/page.tsx:349-358). | N/A. | Not shown. |
| Zuhause / default | Defaults to “Zuhause” red #FF3130; gradient `from-red-50/80 to-rose-100/80` (src/app/ogs_groups/page.tsx:441-448). | Same styling for both fallback and explicit matches (src/app/students/search/page.tsx:339-368). | Group name shown regardless of real location (src/app/myroom/page.tsx:413-428). | No badge. |
| WC | Not handled. | Not handled. | Not handled. | Not shown; ModernStatusBadge would output blue “WC” (src/components/simple/student/ModernStatusBadge.tsx:36-42). |
| Unknown fallback | Treated as “Zuhause.” | Treated as “Zuhause.” | Not surfaced. | ModernStatusBadge (unused) would display grey “Unbekannt” (src/components/simple/student/ModernStatusBadge.tsx:65-70). |

- **OGS group view** — Shares palette with other pages but maintains its own `getLocationStatus`, mixing live room-status data with stale booleans and real-time SSE refresh; duplicated logic risks drift (src/app/ogs_groups/page.tsx:389-448).
- **Student search** — Pulls the same room-status payload without SSE, hard-codes “Gruppenraum,” and collapses rich location strings back to “Zuhause,” so badges become inaccurate between refreshes (src/app/students/search/page.tsx:289-368).
- **My Room** — Fetches per-student records and listens to SSE yet renders only group names, never the actual location states already available (src/app/myroom/page.tsx:78-168,413-428).
- **Student detail modal** — Loads fresh student data for CRUD workflows but omits status badges entirely, even though an enhanced `ModernStatusBadge` component exists (src/components/students/student-detail-modal.tsx:152-200; src/components/simple/student/ModernStatusBadge.tsx:6-84).

1. Extract a shared `getLocationBadge(student, roomStatus?, roomMap?)` (or reuse `ModernStatusBadge`) so every surface consumes one source of truth for labels, colors, and gradients; centralize tokens in a single module before wiring pages to it.
2. Fix state detection in the mapper/helper first: parse `student.current_location` prefixes (“Anwesend - …”, `Bus`, `WC`) and stop abusing `student.in_house` for “Unterwegs,” otherwise the shared helper will keep emitting incorrect states (align with src/lib/student-helpers.ts:129-185).
3. Adopt the shared badge in My Room and the student detail modal, leveraging their existing SSE and fetch flows so supervisors see consistent, real-time locations; confirm if the modal should call `/api/students/:id/current-location` for detailed room names.
4. After consolidation, retire the legacy boolean flags (`school_yard`, `in_house` defaults) once backend ownership confirms the richer `current_location` strings are authoritative; update mapping/tests accordingly.
5. Add targeted tests or Storybook stories covering each location state to prevent regressions once the helper is shared across routes.
