# Environment Files Guide

This document explains the purpose and usage of various environment files in the project.

## Overview

The project uses different environment files for different contexts:

1. **Docker Development** - Root directory environment files
2. **Direct Backend Development** - Backend directory environment files
3. **Direct Frontend Development** - Frontend directory environment files
4. **Production Deployment** - Production environment files

## Docker Development Environment Files

### `.env` (Root directory)
- **Purpose**: Primary configuration for Docker Compose development setup
- **Usage**: Automatically loaded by `docker-compose up`
- **Affects**: All services defined in docker-compose.yml
- **SSL**: Configured with `sslmode=require` for database connections

## Backend Development Environment Files

### `backend/dev.env.example` → `backend/dev.env`
- **Purpose**: Configuration for directly running the backend without Docker
- **Usage**: Copy to `dev.env` and modify; loaded when running Go server directly
- **Affects**: Only the backend service when run directly
- **SSL**: Configured with `sslmode=require` for database connections

### `backend/.env.example` → `backend/.env.local`
- **Purpose**: Alternative backend configuration template
- **Usage**: Legacy/alternative to `dev.env`
- **Affects**: Only used if `dev.env` is not present
- **SSL**: Updated to use `sslmode=require` for database connections

## Frontend Development Environment Files

### `frontend/.env.example` → `frontend/.env.local`
- **Purpose**: Configuration for directly running Next.js frontend without Docker
- **Usage**: Copy to `.env.local` and modify; loaded by Next.js
- **Affects**: Only the frontend when run with `npm run dev`
- **Note**: Does not configure database SSL directly, but points to backend API

## Production Environment Files

### `.env.production.example` → `.env` (on production server)
- **Purpose**: Production configuration for Docker Compose
- **Usage**: Copy to `.env` on production server
- **Affects**: All production services defined in docker-compose.prod.yml
- **SSL**: Configured with `sslmode=verify-full` for maximum security

### `deployment/production/.env.example` → `deployment/production/.env`
- **Purpose**: Caddy server configuration for production
- **Usage**: Copy to `.env` in production deployment directory
- **Affects**: Only the Caddy reverse proxy server configuration
- **Note**: Configures HTTPS/TLS for web traffic (different from database SSL)

## SSL Configuration

All database connections are configured to use SSL:

- **Development**: `sslmode=require` with self-signed certificates
  - Requires running `deployment/postgres/create-certs.sh` first
  - Certificate files are in `.gitignore` and must be generated by each developer

- **Production**: `sslmode=verify-full` recommended 
  - Should use proper CA-signed certificates
  - Higher security with full certificate verification

## Environment Variables Precedence

1. Values in service-specific environment section in docker-compose.yml
2. Values in `.env` file (for Docker Compose)
3. Values in shell environment

For directly run services:
- Backend: Uses `dev.env` or fallback to `.env.local`
- Frontend: Uses `.env.local` or environment variables

## Best Practices

1. Never commit real credentials to git
2. Use example files as templates
3. For development with Docker, modify the root `.env` file
4. For production, use strong passwords and proper SSL certificates