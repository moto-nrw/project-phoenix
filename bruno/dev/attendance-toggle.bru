meta {
  name: Attendance Toggle - Confirm
  type: http
  seq: 41
}

post {
  url: {{baseUrl}}/api/iot/attendance/toggle
  body: json
  auth: none
}

headers {
  Authorization: Bearer {{deviceApiKey}}
  X-Staff-PIN: {{staffPIN}}
  X-Staff-ID: {{staffID}}
  Content-Type: application/json
}

body:json {
  {
    "rfid": "1047722B7A0C88",
    "action": "confirm"
  }
}

script:post-response {
  if (res.status === 200 && res.body.status === "success") {
    const data = res.body.data;
    console.log(`✅ Attendance toggle OK - ${data.action} for student`);
    console.log(`   Attendance record ID: ${data.attendance_id}`);
    
    // Store action for future tests
    bru.setVar("lastAction", data.action);
  } else {
    console.log("❌ Attendance toggle failed:", res.body?.message || `Status: ${res.status}`);
  }
}