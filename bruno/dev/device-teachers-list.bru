meta {
  name: Device Teachers List (Multi-Supervisor)
  type: http
  seq: 20
}

get {
  url: {{baseUrl}}/api/iot/teachers
  body: none
  auth: none
}

headers {
  Authorization: Bearer {{deviceApiKey}}
}

tests {
  test("Teachers list endpoint accessible", function() {
    expect(res.getStatus()).to.equal(200);
    expect(res.getBody()).to.have.property('status', 'success');
    expect(res.getBody()).to.have.property('data');
    expect(res.getBody().data).to.be.an('array');
  });
  
  test("Response includes teacher information", function() {
    const teachers = res.getBody().data;
    if (teachers.length > 0) {
      expect(teachers[0]).to.have.property('staff_id');
      expect(teachers[0]).to.have.property('person_id');
      expect(teachers[0]).to.have.property('first_name');
      expect(teachers[0]).to.have.property('last_name');
      expect(teachers[0]).to.have.property('display_name');
      // Note: PIN status no longer relevant with global PIN
    }
  });
}

script:post-response {
  if (res.status === 200) {
    const teachers = res.body.data;
    console.log("✅ Device teachers list accessible (no PIN required)");
    console.log("Found " + teachers.length + " teachers available for selection");
    
    // Show first few teachers for verification
    if (teachers.length > 0) {
      console.log("\nSample teachers:");
      teachers.slice(0, 3).forEach(teacher => {
        console.log(`- ${teacher.display_name} (Staff ID: ${teacher.staff_id})`);
      });
    }
    
    // Store for use in other tests
    if (teachers.length >= 3) {
      bru.setVar("testSupervisor1", teachers[0].staff_id);
      bru.setVar("testSupervisor2", teachers[1].staff_id);
      bru.setVar("testSupervisor3", teachers[2].staff_id);
      console.log("\nStored test supervisor IDs for multi-supervisor tests");
    }
  } else {
    console.log("❌ Device teachers list failed");
    console.log("Status:", res.status);
    console.log("Response:", res.body);
  }
}