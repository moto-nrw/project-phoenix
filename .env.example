# Docker Compose Environment Variables
#
# This .env file is used by docker-compose directly when running 'docker-compose up'
# It provides environment variables for all services defined in docker-compose.yml
# This is the PRIMARY configuration file for local development with Docker
#
# This .env.example file serves as a template for the actual .env file
# Copy this file to .env and replace the placeholder values with your actual configurations
# IMPORTANT: Never commit your actual .env file to version control

# Timezone Configuration
# Ensures all containers (frontend, backend, database) use the same timezone
# This prevents date calculation mismatches in attendance tracking
TZ=Europe/Berlin

# Database configuration
# Note: SSL is enabled with certificate verification (sslmode=verify-ca) for GDPR compliance and data security
# This requires SSL certificates to be generated with config/ssl/postgres/create-certs.sh
# For Docker container connections:
POSTGRES_PASSWORD=your_secure_db_password
DB_DSN=postgres://postgres:${POSTGRES_PASSWORD}@postgres:5432/postgres?sslmode=require

# Test database configuration (for integration tests)
# Start test DB with: docker compose --profile test up -d postgres-test
# The test database runs on port 5433 to avoid conflicts with the dev database
TEST_DB_PORT=5433
TEST_DB_DSN=postgres://postgres:${POSTGRES_PASSWORD}@localhost:5433/phoenix_test?sslmode=disable

# Server configuration
PORT=8080
LOG_LEVEL=debug
LOG_TEXTLOGGING=true
DB_DEBUG=true
ENABLE_CORS=true

# CORS Security Configuration
# Leave empty to allow all origins (development only!)
# For production, set to comma-separated list of allowed origins:
# CORS_ALLOWED_ORIGINS=http://localhost:3000,https://yourdomain.com
CORS_ALLOWED_ORIGINS=http://localhost:1420,http://localhost:3000,http://localhost:8080

# Rate Limiting Configuration
# Enable rate limiting to prevent abuse and brute force attacks
RATE_LIMIT_ENABLED=false
# General API rate limits (requests per minute)
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10
# Stricter limits for authentication endpoints
RATE_LIMIT_AUTH_REQUESTS_PER_MINUTE=5

# Security Logging Configuration
# Enable logging of security events (auth failures, rate limits, etc.)
SECURITY_LOGGING_ENABLED=false

# Authentication (use strong random strings in production)
AUTH_JWT_SECRET=your_jwt_secret_at_least_32_chars_long
AUTH_JWT_EXPIRY=15m
AUTH_JWT_REFRESH_EXPIRY=24h

# Frontend configuration
NEXT_PUBLIC_API_URL=http://server:8080
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your_nextauth_secret_at_least_32_chars

# Admin Account (for initial setup)
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=your_secure_admin_password_here

# Email configuration
# SMTP settings for sending password reset and invitation emails
# Port 465: Implicit SSL/TLS (recommended) - Port 587: STARTTLS (alternative)
EMAIL_SMTP_HOST=smtp.example.com
EMAIL_SMTP_PORT=465
EMAIL_SMTP_USER=your_email@example.com
EMAIL_SMTP_PASSWORD=your_smtp_password
EMAIL_FROM_NAME=Your Organization
EMAIL_FROM_ADDRESS=noreply@example.com
# In production environments FRONTEND_URL must use https:// scheme
FRONTEND_URL=http://localhost:3000
INVITATION_TOKEN_EXPIRY_HOURS=48
PASSWORD_RESET_TOKEN_EXPIRY_MINUTES=30

# Development flags
SKIP_ENV_VALIDATION=true
NEXT_TELEMETRY_DISABLED=1

# Automated Cleanup (GDPR Compliance)
# Enable automated cleanup of expired visit data
CLEANUP_SCHEDULER_ENABLED=true
# Time to run daily cleanup (24-hour format, e.g., "02:00" for 2 AM)
CLEANUP_SCHEDULER_TIME=02:00
# Cleanup timeout in minutes
CLEANUP_SCHEDULER_TIMEOUT_MINUTES=30

# Session Lifecycle Management
# Enable automatic end of all active sessions at end of day (default: enabled)
SESSION_END_SCHEDULER_ENABLED=true
# Time to automatically end all active sessions (24-hour format, e.g., "18:00" for 6 PM)
SESSION_END_TIME=18:00
# Session end timeout in minutes
SESSION_END_TIMEOUT_MINUTES=10
# Time after which students can check out for the day from their home room
STUDENT_DAILY_CHECKOUT_TIME=15:00

# Abandoned Session Cleanup
# Enable automatic cleanup of abandoned sessions (no activity AND device offline)
SESSION_CLEANUP_ENABLED=true
# How often to check for abandoned sessions (minutes)
SESSION_CLEANUP_INTERVAL_MINUTES=15
# Minutes of inactivity before a session is considered abandoned
# Activity = student RFID scan OR device ping
SESSION_ABANDONED_THRESHOLD_MINUTES=60

# Device Authentication
# Global PIN for all OGS staff to authenticate devices
OGS_DEVICE_PIN=1234

# BetterAuth Configuration (multi-tenancy auth service)
# Generate with: openssl rand -base64 32
BETTER_AUTH_SECRET=your-secret-key-minimum-32-characters-long-change-me
# Internal API URL for BetterAuth to send org lifecycle emails (Docker internal network)
INTERNAL_API_URL=http://server:8080

# Docker BuildKit Configuration (speeds up builds)
DOCKER_BUILDKIT=1
COMPOSE_DOCKER_CLI_BUILD=1
COMPOSE_BAKE=true
