#!/usr/bin/env bash

# Run git-secrets check
git secrets --pre_commit_hook -- "$@"

# Auto-format frontend files with Prettier
FRONTEND_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^frontend/.*\.(ts|tsx|js|jsx|mdx)$' || true)

if [ -n "$FRONTEND_FILES" ]; then
  echo "ðŸŽ¨ Auto-formatting frontend files with Prettier..."
  cd frontend
  echo "$FRONTEND_FILES" | sed 's|^frontend/||' | xargs npx prettier --write --cache
  cd ..

  # Re-stage formatted files
  echo "$FRONTEND_FILES" | xargs git add
  echo "âœ… Frontend files formatted and re-staged"
fi
